#!/data/data/com.termux/files/usr/bin/sh

# Widget Shortcut: Backup
# File: ~/.shortcuts/backup
# Purpose: Backup important files to storage

BACKUP_DIR="/sdcard/termux-backups"
DATE=$(date +%Y%m%d_%H%M%S)

# Create backup directory
mkdir -p "$BACKUP_DIR"

# Backup home directory (excluding large folders)
echo "Creating backup..."

# Get size estimate for progress bar
SIZE=$(du -sb "$HOME" | cut -f1) 2>/dev/null || SIZE=100000000

tar -czf "$BACKUP_DIR/home_$DATE.tar.gz" \
    --exclude='.cache' \
    --exclude='node_modules' \
    --exclude='.termux' \
    -C "$HOME" . 2>/dev/null | pv -lep -s "$SIZE" >/dev/null

# Notify user
if [ -f "$BACKUP_DIR/home_$DATE.tar.gz" ]; then
    echo "Backup complete: home_$DATE.tar.gz"
    termux-notification -t "Backup Complete" -c "Saved to $BACKUP_DIR"
else
    echo "Backup failed!"
    termux-notification -t "Backup Failed" -c "Check terminal for errors"
fi
